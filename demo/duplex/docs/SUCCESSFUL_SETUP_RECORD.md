# RP5 Full-Duplex ì„±ê³µ ì„¸íŒ… ê¸°ë¡
# Date: 2025-11-14

## âœ… ê²€ì¦ ì™„ë£Œ êµ¬ì„±

### ë„¤íŠ¸ì›Œí¬
- **ì—°ê²° ë°©ì‹**: WiFi Direct
- **RP5-A (test1)**: 10.42.0.1 (Hotspot/AP)
- **RP5-B (test2)**: 10.42.0.224 (Client)
- **í¬íŠ¸**: 
  - Aâ†’B: 9999
  - Bâ†’A: 9998

### ì˜¤ë””ì˜¤ ë””ë°”ì´ìŠ¤ (í˜„ì¬)
- **í˜„ì¬ ì‚¬ìš©**: USB Audio (H08A)
- **ì„¤ì •**: Stereo input/output (mono ë³€í™˜ ì²˜ë¦¬)
- **Sample rate**: 48kHz (hardware) â†’ 16kHz (processing) â†’ 48kHz (output)

### ì˜¤ë””ì˜¤ ë””ë°”ì´ìŠ¤ (í–¥í›„ ê³„íš)
âš ï¸ **ì¤‘ìš”**: ì¶”í›„ ë‹¤ìŒ êµ¬ì„±ìœ¼ë¡œ ë³€ê²½ ì˜ˆì •
- **Microphone**: ë³„ë„ ë§ˆì´í¬ ë””ë°”ì´ìŠ¤
- **Speaker**: ë¸”ë£¨íˆ¬ìŠ¤ ìŠ¤í”¼ì»¤
- **ê³ ë ¤ì‚¬í•­**: 
  - ë””ë°”ì´ìŠ¤ ë…ë¦½ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„
  - Mono mic + Stereo speaker ì¡°í•© ì§€ì›

### ì½”ë± ì„¤ì •
- **Codec**: Opus
- **Sample rate**: 16kHz
- **Bitrate**: 16kbps
- **Frame duration**: 20ms (320 samples @ 16kHz)
- **Channels**: 1 (mono)

### ë²„í¼ ì„¤ì •
- **Queue size**: 5 frames
- **Chunk size**: 960 samples @ 48kHz (20ms)

### í•µì‹¬ ìˆ˜ì •ì‚¬í•­
âœ… **í•´ê²°ëœ ë²„ê·¸**: Opus ì½”ë± ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜
- **ë¬¸ì œ**: `audio_int16 = (audio * 32767).astype(np.int16)` â†’ `codec.encode(audio_int16)` (ì´ì¤‘ ë³€í™˜)
- **í•´ê²°**: `codec.encode(audio_float32)` ì§ì ‘ ì „ë‹¬

## ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

### Latency
- **AI ì—†ìŒ**: ~500ms (ë§¤ìš° ë‚®ìŒ)
- **êµ¬ì„±**: Mic â†’ Downsample â†’ Encode â†’ Network â†’ Decode â†’ Upsample â†’ Speaker

### íŒ¨í‚· ì „ì†¡
- **Rate**: ~50 packets/s
- **Packet size**: 40-50 bytes
- **Loss**: < 1%

### ìŒì§ˆ
- **ìƒíƒœ**: ëª…ë£Œí•¨
- **íŠ¹ì´ì‚¬í•­**: 
  - RP5-A (Hotspot): ê°€ë” ëŠê¹€ ë°œìƒ
  - RP5-B (Client): ëŠê¹€ ì—†ìŒ

## âš ï¸ ì•Œë ¤ì§„ ì´ìŠˆ

### Issue 1: RP5-A ìŒì„± ëŠê¹€
**ì¦ìƒ**: 
- Hotspot ìš´ì˜í•˜ëŠ” test1ì—ì„œ ì†¡ì‹  ì‹œ ìŒì„±ì´ ê°„í—ì ìœ¼ë¡œ ëŠê¹€
- Clientì¸ test2ëŠ” ì •ìƒ

**ì¶”ì • ì›ì¸**:
1. Hotspot AP ìš´ì˜ + ì˜¤ë””ì˜¤ ì²˜ë¦¬ë¡œ ì¸í•œ CPU ë¶€í•˜
2. WiFi Direct AP ëª¨ë“œì˜ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ì˜¤ë²„í—¤ë“œ
3. ì†¡ì‹ /ìˆ˜ì‹  ë™ì‹œ ì²˜ë¦¬ ì‹œ buffer underrun

**í•´ê²° ë°©í–¥**:
- [ ] ë²„í¼ í¬ê¸° ì¦ê°€ (test1 ì „ìš©)
- [ ] ìŠ¤ë ˆë“œ ìš°ì„ ìˆœìœ„ ì¡°ì •
- [ ] CPU governor ì„¤ì • (performance mode)
- [ ] WiFi channel ìµœì í™”

### Issue 2: í–¥í›„ ì˜¤ë””ì˜¤ ë””ë°”ì´ìŠ¤ ë³€ê²½
**ê³„íš**: USB â†’ ë§ˆì´í¬ + ë¸”ë£¨íˆ¬ìŠ¤ ìŠ¤í”¼ì»¤
**ê³ ë ¤ì‚¬í•­**:
- ë””ë°”ì´ìŠ¤ ë…ë¦½ ì„ íƒ UI
- Mono/Stereo ìœ ì—°í•œ ì²˜ë¦¬
- ë¸”ë£¨íˆ¬ìŠ¤ latency ì¶”ê°€ ê³ ë ¤

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **ëª¨ë“ˆí™” ì•„í‚¤í…ì²˜ êµ¬í˜„**
   - í†µì‹  ëª¨ë“ˆ ë¶„ë¦¬
   - ì˜¤ë””ì˜¤ ì²˜ë¦¬ í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°
   - í† ê¸€ ì‹œìŠ¤í…œ

2. **RP5-A ëŠê¹€ í•´ê²°**
   - ë²„í¼ ìµœì í™”
   - ì„±ëŠ¥ íŠœë‹

3. **AI ë””ë…¸ì´ì§• í†µí•©**
   - í† ê¸€ ì§€ì›
   - Light-32-Depth4 ëª¨ë¸

4. **ê³ ì „ì  í•„í„° ì¶”ê°€**
   - ì—­ìœ„ìƒ
   - BSS
   - ì£¼íŒŒìˆ˜/ì§„í­ í•„í„°

---
**ê¸°ë¡ì¼**: 2025-11-14
**ê²€ì¦ í™˜ê²½**: RP5-A (test1) + RP5-B (test2)
**ìƒíƒœ**: âœ… WiFi ì–‘ë°©í–¥ í†µì‹  ì„±ê³µ
